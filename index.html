<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="/favicon.ico" />
    <title>fairy lights</title>
    <link rel="stylesheet" href="node_modules/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="node_modules/reveal.js/css/theme/black.css">
    <link rel="stylesheet" href="css/syntax.css">
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section id="setup">
          <h3 class="badge">settings</h3>
          <form class="fullscreen" style="background: #444" id="settings">
            <label>
              lanterns
              <input type="url" name="lantern" placeholder="http://localhost:3000">
            </label>
            <label>
              layout
              <input type="url" name="layout" placeholder="http://foo.json">
            </label>
            <label>
              width
              <input type="number" name="width">
            </label>
            <label>
              height
              <input type="number" name="height">
            </label>
            <p id="settings-error"></p>
          </form>
        </section>
        <section>
          <section><h1>I'm Ben</h1></section>
          <section><h2>I talk a lot</h2></section>
          <section><h2>pipe-share</h2></section>
          <section><h1>20s</h1></section>
          <!-- <section>
            <h2>The kindness to help people be proud of the things they do</h2>
            <h1>RIP JP</h1>
          </section> -->
        </section>

        <section>
          <section>
            <h1>LEDs</h1>
          </section>
          <section>
            <h1>[led]</h1>
          </section>
          <section>
            <h1>[PWM]</h1>
          </section>
          <section>
            <h1>[espriuno]</h1>
          </section>
          <section>
            <h1>[tricolor LED]</h1>
          </section>
          <section>
            <h1>Communicating with fairy lights</h1>
          </section>
          <section data-background="images/nodemcu.jpg">
            <footer>
              <a href="https://commons.wikimedia.org/w/index.php?curid=39477865">
                source: wikipedia.org/wiki/NodeMCU (Vowstar)
              </a>
            </footer>
          </section>
        </section>

        <section>
          <section>
            <h1>Browser -> HTTP POST -> MCU -> FAIRY LIGHTS</h1>
          </section>
          <section>
            <pre><code data-trim>
            &lt;form action="http://192.168.0.12" method="POST" &gt;
              &lt;input name="color" type="color"&gt;
              &lt;input type="submit"&gt;
            &lt;/form&gt;
            </code></pre>
          </section>
          <section>
            <h1>It works!</h1>
          </section>
          <section
            data-background-size="contain"
            data-background="images/http.svg">
          </section>
          <section
            data-background-size="contain"
            data-background="images/http-annotated-1.svg">
          </section>
          <section
            data-background-size="contain"
            data-background="images/http-annotated-2.svg">
          </section>
          <section>
            <h1>TCP vs UDP</h1>
          </section>
          <section>
            <pre><code data-trim>
              const dgram = require('dgram')
              const client = dgram.createSocket('udp4')
              const colour = String.fromCharCode(255, 150, 0)
              client.send(Buffer.from(`FILL ${colour}`), 8080, 192.168.0.12)
            </code></pre>
          </section>
          <section>
            <h6>[browser → server → MCU → fairy lights]</h6>
          </section>
        </section>

        <section>
          <section>
            <h1>Browser -> WS -> Server -> UDP -> MCU -> FAIRY LIGHTS</h1>
          </section>
          <section class="left">
            <h1>Demo</h1>
            <pre><code data-trim>
              &lt;input type="color" /&gt;
            </code></pre>
          </section>
          <section>
            <input type="color" />
          </section>
        </section>

        <section>
          <section>
            <h2>Adding context:</h2>
            <h3>{A: [{n:0}, {n: 50}]}</h3>
          </section>
          <section class="left">
            <h5>Demo</h5>
            <h2>HTML &rarr; Fairy Lights</h2>
            <pre><code data-trim>
              &lt;ol&gt;
                &lt;li&gt;&lt;/li&gt;
                &lt;li&gt;&lt;/li&gt;
                &lt;li&gt;&lt;/li&gt;
                &lt;li&gt;&lt;/li&gt;
              &lt;/ol&gt;
              &lt;style&gt;
                li:nth-child(2n) {background: red}
              &lt;/style&gt;
            </code></pre>
          </section>
          <section>
            <h1>
            <select>
              <option>none</option>
              <option>red</option>
              <option>nth</option>
              <option>:hover</option>
            </select>
          </h1>
            <ol class="light-list">
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
              <li></li> <li></li> <li></li> <li></li> <li></li> <li></li>
            </ol>
          </section>
        </section>


        <section>
          <section>
            <h2>Adding (more) context:</h2>
            <h3>{A: [{n:0, x: 0}, {n: 50, x: 1}]}</h3>
          </section>
          <section>
            <h3>WebGL</h3>
          </section>
          <section>
            <iframe data-lantern-src="/scripts/ambient.html" class="fullscreen"></iframe>
          </section>

          <section>
            <h3>[4d noise]</h3>
          </section>
          <section>
            <h3>[bubbles]</h3>
          </section>
        </section>

        <section>
          <section>
            <h2>Adding input:</h2>
          </section>
          <section>
            <h3>[demo audio]</h3>
          </section>
          <section>
            <h3>[demo leap]</h3>
          </section>
        </section>

        <section>
          <section>
            <h1>Making use of our abstraction</h1>
          </section>
          <section>
            <h1>[JS, WEBGL, WEBSOCKET]</h1>
          </section>
          <section>
            <h1>[10x10]</h1>
          </section>
          <section>
            <h1>[10x10]</h1>
          </section>
        </section>


        <section>
          <section><h1>Abstractions</h1></section>
          <section><h2>Moving from events to ideas</h2></section>
          <section>
            <h1>[us, them, events]</h1>
          </section>
        </section>

        <section>
          <section>
            <h1>Intuitive interactions</h1>
          </section>
          <section>
            <h2>[sandpit]</h2>
            <p>Bring technology into our world</p>
          </section>
          <section>
            <h2>[wings]</h2>
            <p>Bring us into technology</p>
          </section>
          <section>
            <h2>[?interactive coding]</h2>
            <p>Exposing technology</p>
          </section>
          <section>
            <h2>[?home, vr, ar]</h2>
            <p>Not just for crazy stuff</p>
          </section>
        </section>

        <section>
          <section>
            <h1>Getting started</h1>
          </section>
          <section>
            <h1>PI</h1>
            <h1>nodeMCU</h1>
            <h1>espruino</h1>
          </section>
        </section>

        <section>
          <h2>@benjaminbenben</h2>
          <h1 class="fragment">Light Hacking?</h1>
        </section>

        <section>
          <h2>@benjaminbenben</h2>
          <h1>Thanks<span class="fragment">, JP</span></h1>
        </section>

      </div>
    </div>

    <script src="node_modules/reveal.js/lib/js/head.min.js"></script>
    <script src="node_modules/reveal.js/js/reveal.js"></script>

    <script>


      const qs  = document.querySelector.bind(document)
      const qsa = document.querySelectorAll.bind(document)

      const settings = window.setttings = {}

      for(let input of qsa('#settings input[name]')) {

        setttings[input.name] = input.value = localStorage.getItem(`config:${input.name}`)

        input.addEventListener('change', ({target}) =>
          localStorage.setItem(
            `config:${target.name}`,
            setttings[target.name] = target.value
          )
        )
      }

      const setsrcs = async () => {
        const a = document.createElement('a')
        a.href = settings.lantern
        const { origin } = a

        const res = await fetch(settings.layout)

        if(res.status !== 200) throw new Error(`Layout ${res.status}ed`)

        const layout = await res.json()

        const hash = btoa(JSON.stringify({
          layout,
          development: true,
          dark: true
        }))

        for(let {dataset} of qsa('[data-lantern-src]')  ) {
          dataset.src = `${origin}${dataset.lanternSrc}#${hash}`
        }
      }

      const updatesrcs = () =>
        setsrcs()
          .then(
            () => qs('#settings-error').textContent = '🌈',
            e  => qs('#settings-error').textContent = e
          )

      for(let input of qsa('input[name=lantern], input[name=layout]')) {
        input.addEventListener('change', updatesrcs)
      }

      updatesrcs()

      Reveal.initialize({
        margin: 0,
        history: true,
        controls: false,
        transition: 'none',
        progress: true,
        dependencies: [
          {
            src: 'node_modules/reveal.js/plugin/highlight/highlight.js',
            async: true,
            callback: () => hljs.initHighlightingOnLoad()
          }
        ]
      });


      const {width, height} = Reveal.getConfig()

      // set css vars for fullscreen
      const rootStyle = document.body.style
      rootStyle.setProperty('--reveal-width', `${width}px`)
      rootStyle.setProperty('--reveal-height', `${height}px`)


      // set placeholders for height/width based on screen dimensions
      // (some projectors are weird)
      const sw = qs('#settings input[name=width]')
      const sh = qs('#settings input[name=height]')
      const setw = () => sw.placeholder = parseFloat(sh.value) * (width/height)
      const seth = () => sh.placeholder = parseFloat(sw.value) / (width/height)

      sh.addEventListener('input', setw)
      sw.addEventListener('input', seth)

      if(sh.value) setw()
      if(sw.value) seth()

    </script>
  </body>
</html>
